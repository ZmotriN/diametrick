const ready=e=>{document.addEventListener("DOMContentLoaded",(t=>{e(t)}))},bind=(e,t,n)=>{"string"==typeof e?document.querySelectorAll(e).forEach((e=>{e.addEventListener(t,n)})):e.addEventListener(t,n)},query=(e,t=!1)=>t?document.querySelectorAll(e):document.querySelector(e),click=(e,t)=>{"string"==typeof e&&(e=query(e)),e.addEventListener("click",t)},redirect=(e="")=>{document.location.href=root+e},redirectReferer=()=>{let e=root;const t=new URL(document.baseURI),n=new URL(document.referrer,document.baseURI);n.hostname==t.hostname&&n.pathname!=t.pathname&&(e=n.href),document.location.href=e},striptags=e=>e.replace(/(<([^>]+)>)/gi,""),count=e=>e.filter((function(e){return!0})).length,lowslug=e=>e.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s\-]/g,"").replace(/[\s\t]+/g,""),copyToClipboard=async e=>{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(e){console.error(e)}finally{t.remove()}}},forceKeyPressUppercase=e=>{let t=e.target,n=e.keyCode;if(n>=97&&n<=122&&!e.ctrlKey&&!e.metaKey&&!e.altKey){let o=n-32,i=t.selectionStart,s=t.selectionEnd;t.value=t.value.substring(0,i)+String.fromCharCode(o)+t.value.substring(s),t.setSelectionRange(i+1,i+1),e.preventDefault()}},decodeEntities=function(){let e=document.createElement("div"),t=/&(?:#x[a-f0-9]+|#[0-9]+|[a-z0-9]+);?/gi;return function(n){return n=n.replace(t,(function(t){return e.innerHTML=t,e.textContent})),e.textContent="",n}}(),isInViewport=(e,t=!1)=>{const{top:n,left:o,bottom:i,right:s}=e.getBoundingClientRect(),{innerHeight:r,innerWidth:a}=window;return t?(n>0&&n<r||i>0&&i<r||n<0&&i>r)&&(o>0&&o<a||s>0&&s<a||o<0&&s>a):n>=0&&o>=0&&i<=r&&s<=a},post=(e,t=!1)=>{let n=new URL(document.baseURI).pathname;return fetch(n,{method:"POST",body:JSON.stringify(e)}).then((e=>e.text())).then((e=>{t&&console.log(e);let n=JSON.parse(e);return null==n.success?{success:!1,errmsg:"Réponse du serveur invalide."}:n})).catch((e=>({success:!1,errmsg:"Format de réponse du serveur invalide."})))},geturl=(e,t=!1)=>fetch(e).then((e=>e.text())).then((e=>(t&&console.log(e),JSON.parse(e)))).catch((e=>console.warn(e))),postmodal=(e,t,n=!1)=>{Modal.show(),post(t,n).then((t=>{if(void 0===t)Modal.hide();else if(t.success)if(n)Modal.hide();else if(e)if("function"==typeof e)Modal.hide(),e(t);else if(!0===e){const e=new URL(document.baseURI);new URL(document.referrer,document.baseURI).hostname==e.hostname&&(document.location.href=document.referrer)}else redirect(e);else location.reload();else Modal.hide(),ModalBox.error("Erreur: "+t.errmsg)}))},Modal={show:function(){document.querySelector("div#modal").classList.add("show")},hide:function(){document.querySelector("div#modal").classList.remove("show")}},ModalPlane={show:function(e=null){document.querySelector("div#modal_plane").classList.add("show"),setTimeout((()=>{this.hide(),e&&e()}),1650)},hide:function(){document.querySelector("div#modal_plane").classList.remove("show")}};class ModalForm{modal=null;loading=null;message=null;container=null;opened=!1;constructor(e){this.modal=document.querySelector(e),this.loading=this.modal.querySelector(".modalform__loading"),this.message=this.modal.querySelector(".modalform__message"),this.container=this.modal.querySelector(".modalform__container"),this.modal.addEventListener("mousedown",(e=>{(e.target.classList.contains("modalform")||e.target.classList.contains("modalform__message"))&&this.hide()})),document.addEventListener("keydown",(e=>{this.opened&&("Escape"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||this.hide())}))}show(e=null,t=0){this.opened=!0,this.loading&&(this.loading.classList.add("show"),this.container.classList.add("hide")),this.message&&e&&(this.message.innerHTML=e,t&&setTimeout((()=>{this.hide()}),t)),this.modal.classList.add("show")}hide(){this.opened=!1,this.modal.classList.remove("show")}load(e){this.container.innerHTML=e,this.loading.classList.remove("show"),this.container.classList.remove("hide")}unload(){this.loading.classList.add("show"),this.container.classList.add("hide")}}class ModalBoxContainer{modal=null;alert=null;warning=null;error=null;bravo=null;thumbsup=null;opened=!1;clb=null;constructor(e){this.modal=document.querySelector(e),this.alert=this.modal.querySelector(".modalform__box.alert"),this.warning=this.modal.querySelector(".modalform__box.warning"),this.error=this.modal.querySelector(".modalform__box.error"),this.bravo=this.modal.querySelector(".modalform__box.bravo"),this.thumbsup=this.modal.querySelector(".modalform__box.thumbsup"),this.modal.addEventListener("mousedown",(e=>{(e.target.classList.contains("modalform")||e.target.classList.contains("modalform__box"))&&this.hide()})),document.addEventListener("keydown",(e=>{this.opened&&("Escape"!==e.key||e.ctrlKey||e.altKey||e.shiftKey?"Enter"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||(e.preventDefault(),this.hide()):(e.preventDefault(),e.stopPropagation(),this.hide()))}))}show(e=null,t=null){this.opened=!0,this.clb=t,this.alert?this.alert.innerHTML=e:this.warning?this.warning.innerHTML=e:this.error?this.error.innerHTML=e:this.bravo?this.bravo.innerHTML=e:this.thumbsup&&(this.thumbsup.innerHTML=e),this.modal.classList.add("show")}hide(){this.opened=!1,this.modal.classList.remove("show"),this.clb&&this.clb()}}class ModalBoxConfirm{modal=null;container=null;opened=!1;clbyes=null;clbno=null;constructor(e){this.modal=document.querySelector(e),this.container=this.modal.querySelector(".modalform__confirm__container"),this.modal.querySelector(".modalform__confirm__icons .checkmark").addEventListener("click",(e=>{this.yes()})),this.modal.querySelector(".modalform__confirm__icons .xmark").addEventListener("click",(e=>{this.no()})),this.modal.addEventListener("mousedown",(e=>{e.target.classList.contains("modalform")&&this.no()})),document.addEventListener("keydown",(e=>{this.opened&&("Escape"!==e.key||e.ctrlKey||e.altKey||e.shiftKey?"Enter"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||this.yes():this.no())}))}show(e=null,t=null,n=null){this.opened=!0,this.clbyes=t,this.clbno=n,this.container.innerHTML=e,this.modal.classList.add("show")}hide(){this.opened=!1,this.modal.classList.remove("show")}yes(){this.hide(),this.clbyes&&this.clbyes()}no(){this.hide(),this.clbno&&this.clbno()}}const ModalBox={modalalert:null,modalwarning:null,modalerror:null,modalbravo:null,modalthumbsup:null,modalconfirm:null,modalnotif:null,alert:function(e,t=null){this.modalalert||(this.modalalert=new ModalBoxContainer("#modal_alert")),this.modalalert.show(e,t)},warning:function(e,t=null){this.modalwarning||(this.modalwarning=new ModalBoxContainer("#modal_warning")),this.modalwarning.show(e,t)},error:function(e,t=null){this.modalerror||(this.modalerror=new ModalBoxContainer("#modal_error")),this.modalerror.show(e,t)},bravo:function(e,t=null,n=0){this.modalbravo||(this.modalbravo=new ModalBoxContainer("#modal_bravo")),this.modalbravo.show(e,t),n&&setTimeout((()=>{this.modalbravo.hide()}),n)},thumbsup:function(e,t=null,n=0){this.modalthumbsup||(this.modalthumbsup=new ModalBoxContainer("#modal_thumbsup")),this.modalthumbsup.show(e,t),n&&setTimeout((()=>{this.modalthumbsup.hide()}),n)},confirm:function(e,t=null,n=null){this.modalconfirm||(this.modalconfirm=new ModalBoxConfirm("#modal_confirm")),this.modalconfirm.show(e,t,n)},notification:function(e,t=1500){this.modalnotif||(this.modalnotif=query("#modal_notif")),this.modalnotif.innerHTML=e,this.modalnotif.classList.add("show"),setTimeout((()=>{this.modalnotif.classList.remove("show")}),t)}};class PellEditor{editor=null;value=null;elm=null;constructor(e,t=""){this.value=t,this.elm=query(e),this.elm.classList.add("pell"),this.editor=pell.init({element:this.elm,onChange:e=>{this.value=e},defaultParagraphSeparator:"p",styleWithCSS:!1,actions:["bold","underline","italic","superscript","subscript"]}),this.editor.addEventListener("paste",(function(e){if(e.stopPropagation(),e.preventDefault(),navigator.clipboard)navigator.clipboard.readText().then((e=>{var t=document.createElement("div");t.innerHTML=e;var n=t.textContent;window.pell.exec("insertText",n.replace(/[\n\r]+|[\s]{2,}/g," ").trim()),t.remove()}));else{var t=e.clipboardData||window.clipboardData,n=document.createElement("div");n.innerHTML=t.getData("text/html");var o=n.textContent;window.pell.exec("insertText",o.replace(/[\n\r]+|[\s]{2,}/g," ").trim()),n.remove()}return!0})),this.editor.content.innerHTML=this.value}getValue(){return this.editor.content.innerHTML}setValue(e){this.value=e,this.editor.content.innerHTML=this.value}focus(){setTimeout((()=>{this.editor.content.focus()}),0)}}class DragList{parent=null;list=null;items=[];constructor(e,t){this.parent=t,this.list=query(e),this.list.classList.add("draglist")}addItem(e){let t=this.items.length;return this.items.push(new DragItem(e,t,this)),this.items[t].setNumber(this.items.filter((function(e){return!0})).length),t}dragend(e,t){this.items.every((n=>{if(!n.isDragOver(e))return!0;n.container.classList.remove("dragover"),n.container.compareDocumentPosition(t.container)==Node.DOCUMENT_POSITION_PRECEDING?n.container.after(t.container):n.container.before(t.container)})),this.resetNumbers()}resetNumbers(e=1){this.list.querySelectorAll("li").forEach((t=>{this.items[t.dataset.idx].setNumber(e++)}))}trashItem(e){this.parent.trashItem(e,(()=>{this.items[e].trash(),delete this.items[e],this.resetNumbers()}))}editItem(e){this.parent.editItem(e)}getIndexes(){let e=[];return this.list.querySelectorAll("li").forEach((t=>{e.push(t.dataset.idx)})),e}}class DragItem{idx=null;parent=null;container=null;content=null;over=!1;number=0;constructor(e,t,n){this.idx=t,this.parent=n,this.container=document.createElement("li"),this.container.dataset.idx=this.idx;let o=document.createElement("div");o.className="dragicons",this.number=document.createElement("span"),this.number.className="dragnumber",this.number.innerText="#1",o.appendChild(this.number);let i=document.createElement("div");i.className="icon edit",o.appendChild(i),click(i,(e=>{this.parent.editItem(this.idx)}));let s=document.createElement("div");s.className="icon trash",o.appendChild(s),click(s,(e=>{this.parent.trashItem(this.idx)}));let r=document.createElement("div");r.className="icon dots",r.draggable=!0,o.appendChild(r),this.content=document.createElement("div"),this.content.className="dragcontent",this.content.appendChild(e),this.container.appendChild(o),this.container.appendChild(this.content),this.parent.list.appendChild(this.container),bind(r,"dragstart",(e=>{this.container.classList.add("dragging")})),bind(r,"dragend",(e=>{this.container.classList.remove("dragging"),this.parent.dragend(e,this)})),bind(this.container,"dragover",(e=>(e.preventDefault(),!0))),bind(this.container,"dragenter",(e=>{e.preventDefault(),this.container.classList.add("dragover")})),bind(this.container,"dragleave",(e=>{e.preventDefault(),this.isDragOver(e)||this.container.classList.remove("dragover")}))}isDragOver(e){let t=document.body.getBoundingClientRect(),n=this.container.getBoundingClientRect(),o=n.top-t.top,i=n.bottom-t.top,s=n.left-t.left,r=n.right-t.left;return e.pageX>s&&e.pageX<r&&e.pageY>o&&e.pageY<i}setNumber(e){this.number.innerText="#"+e}edit(e){this.content.querySelectorAll("*").forEach((e=>{e.remove()})),this.content.appendChild(e)}trash(){this.container.remove()}}